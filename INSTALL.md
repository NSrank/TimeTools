# TimeTools 安装指南

## 系统要求

- **Velocity**: 3.3.0 或更高版本
- **Java**: 17 或更高版本
- **操作系统**: 支持Java的任何操作系统

## 安装步骤

### 1. 下载插件

从以下位置获取最新版本的TimeTools插件：
- GitHub Releases页面
- 或者从源码构建

### 2. 安装插件

1. 停止Velocity服务器
2. 将`TimeTools-1.0-SNAPSHOT.jar`文件复制到Velocity服务器的`plugins`目录
3. 启动Velocity服务器

### 3. 首次配置

插件首次启动时会自动创建以下文件结构：

```
plugins/
└── timetools/
    ├── config.yml      # 主配置文件
    └── tasks.yml       # 任务数据文件（自动生成）
```

### 4. 权限配置

在Velocity的权限系统中为管理员添加以下权限：

```yaml
# 示例权限配置（具体格式取决于你使用的权限插件）
permissions:
  admin:
    - timetools.admin
```

### 5. 验证安装

启动服务器后，在控制台执行以下命令验证插件是否正常工作：

```
timetools info
```

如果看到插件信息输出，说明安装成功。

## 配置说明

### config.yml 主要配置项

```yaml
# 调试模式
debug: false

# 任务检查间隔（秒）
check-interval-seconds: 60

# 最大执行线程数
max-execution-threads: 5

# 消息配置
messages:
  task-created: "§a任务创建成功！任务ID: {id}"
  # ... 其他消息配置
```

### 重要配置说明

- **check-interval-seconds**: 主调度器检查任务的频率，建议保持60秒
- **max-execution-threads**: 同时执行任务的最大线程数，根据服务器性能调整
- **debug**: 开启后会输出详细的调试信息，生产环境建议关闭

## 常见问题

### Q: 插件无法加载
A: 检查以下几点：
1. Java版本是否为17或更高
2. Velocity版本是否为3.3.0或更高
3. 查看控制台错误日志

### Q: 任务不执行
A: 检查以下几点：
1. 任务是否已启用：`/timetools list <任务ID>`
2. 时间格式是否正确
3. 查看控制台日志

### Q: 权限问题
A: 确保用户拥有`timetools.admin`权限

### Q: 配置文件损坏
A: 删除`plugins/timetools/config.yml`，重启服务器会自动重新创建

## 升级指南

### 从旧版本升级

1. 停止服务器
2. 备份`plugins/timetools/`目录
3. 替换插件jar文件
4. 启动服务器
5. 检查配置文件是否需要更新

### 配置迁移

插件会自动处理配置文件的向后兼容性，但建议在升级前备份配置。

## 卸载指南

1. 停止服务器
2. 删除`plugins/TimeTools-1.0-SNAPSHOT.jar`
3. 删除`plugins/timetools/`目录（如果要完全清除数据）
4. 启动服务器

## 技术支持

如果遇到问题，请：

1. 查看控制台日志
2. 检查配置文件格式
3. 在GitHub Issues页面报告问题
4. 提供详细的错误信息和配置文件

## 性能优化建议

1. **合理设置检查间隔**: 不要将`check-interval-seconds`设置得太小
2. **限制任务数量**: 避免创建过多的高频率任务
3. **监控资源使用**: 定期检查CPU和内存使用情况
4. **使用间隔任务**: 对于需要频繁执行的任务，使用间隔模式而不是固定时间模式

## 最佳实践

1. **任务命名**: 使用有意义的任务ID，便于管理
2. **测试命令**: 在创建任务前，先在控制台测试命令是否正确
3. **备份配置**: 定期备份任务配置文件
4. **监控日志**: 定期查看插件日志，及时发现问题
5. **权限管理**: 只给必要的用户分配管理权限
